<!doctype html>
<html lang="en">

<head>
  <title>CS4241 Assignment 2</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="css/style.css" />
</head>

<body>
  <h1>Todo</h1>
  <details>
    <summary>
      <img src="drop-down-icon.jpg" class="dropdown">
      <div class="priority high"></div>
    </summary>
    <div class="container high"></div>
  </details>
  <details>
    <summary>
      <img src="drop-down-icon.jpg" class="dropdown">
      <div class="priority medium"></div>
    </summary>
    <div class="container medium"></div>
  </details>
  <details>
    <summary>
      <img src="drop-down-icon.jpg" class="dropdown">
      <div class="priority low"></div>
    </summary>
    <div class="container low"></div>
  </details>
  <form action="">
    <input type='text' id='task' placeholder="task name">
    <input type="date" id='due'>
    <button>submit</button>
  </form>
</body>
<script>

  const submit = function (e) {
    // prevent default form action from being carried out
    e.preventDefault()

    const task = document.querySelector('#task'),
      due = document.querySelector('#due'),
      json = { taskname: task.value, dueDate: due.value },
      body = JSON.stringify(json)

    fetch('/submit', {
      method: 'POST',
      body
    })
      .then(response => response.json())
      .then((json) => {
        // console.log(json)
        Array.from(document.body.getElementsByClassName(`container`)).forEach(e => e.innerHTML = '')
        Array.from(json).forEach(element => {
          let container = document.body.getElementsByClassName(`container ${element.priority}`) 
          container[0].innerHTML += element.html      
        })
      })

    return false
  }

  window.onload = function () {
    const button = document.querySelector('button')
    button.onclick = submit
  }

</script>

</html>