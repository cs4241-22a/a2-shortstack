<!DOCTYPE html>
<html lang="en">
  <head>
    <title>CS4241 Assignment 2</title>
    <link rel="stylesheet" type="text/css" href="/css/style.css" />
    <meta charset="utf-8" />
  </head>
  <body>
    <script src="js/scripts.js"></script>
    <h1>ERG WORKOUT LOGBOOK</h1>
    <form action="input">
      <ul>
        <li>
          <label for="date">Date:</label>
          <input type="text" id="date" value="(mm/dd)" />
        </li>
        <li>
          <label for="time">Elapsed Time:</label>
          <input type="text" id="time" value="(min)" />
        </li>
        <li>
          <label for="meters">Total Meters:</label>
          <input type="text" id="meters" value="" />
        </li>
        <li class="submit">
          <button class ="label" id="submit">Record your workout</button>
        </li>
      </ul>
    </form>
    <h2>
      LOGBOOK
    </h2>
    <table id="log">
      <tr>
        <th class="label" scope="col">Date (mm/dd)</th>
        <th scope="col">Time (min)</th>
        <th scope="col">Meters</th>
        <th scope="col">Avg Split (min/500m)</th>
      </tr>
    </table>
  </body>
</html>

<script>

  const submit = function (e) {
    // prevent default form action from being carried out
    e.preventDefault();

    const nDate = document.querySelector("#date"),
      nTime = document.querySelector("#time"),
      nMeters = document.querySelector("#meters"),
      json = { date: nDate.value, time: nTime.value, meters: nMeters.value },
      body = JSON.stringify(json);

    fetch("/submit", {
      method: "POST",
      body,
    }).then(function (response) {
      response.text().then(function (json) {
      
        let table = document.getElementById("log"),
          newRow = table.insertRow(-1),
          newDate = newRow.insertCell(0),
          newTime = newRow.insertCell(1),
          newMeters = newRow.insertCell(2),
          newSplit = newRow.insertCell(3);
        
        const array = json.split(":")
        let SPLIT = array[array.length-1];
        let METERS = array[array.length-2];
        let TIME = array[array.length-3];
        let DATE = array[array.length-4];

        newDate.innerHTML = DATE.substring(2,6);
        newTime.innerHTML = TIME.substring(1,4).replaceAll('"', '');
        newMeters.innerHTML = METERS.substring(1,6).replaceAll('"', '');
        newSplit.innerHTML = SPLIT.substring(1,5);
        console.log(json);
      });
    });

    return false;
  };

  window.onload = function () {
    const submitB = document.getElementById("submit");
    const retrieveB = document.getElementById("retrieve");
    submitB.onclick = submit;
    retrieveB.onclick = addLog;
  };
</script>
