<!doctype html>
<html lang="en">

<head>
  <title>CS4241 Assignment 2</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="css/style.css" />
</head>

<body>
  <h1 id="header">Todo</h1>
  <details>
    <summary class="high">
      <img src="drop-down-icon.jpg" class="dropdown high closed">
      <div class="priority high"></div>
    </summary>
    <div class="container high closed"></div>
  </details>
  <details>
    <summary class="medium">
      <img src="drop-down-icon.jpg" class="dropdown medium closed">
      <div class="priority medium"></div>
    </summary>
    <div class="container medium closed"></div>
  </details>
  <details>
    <summary class="low">
      <img src="drop-down-icon.jpg" class="dropdown low closed">
      <div class="priority low"></div>
    </summary>
    <div class="container low closed"></div>
  </details>
  <form action="">
    <input type='text' id='task' placeholder="task name">
    <input type="date" id='due'>
    <button>submit</button>
  </form>
</body>
<script>
  const submit = function (e) {
    // prevent default form action from being carried out
    e.preventDefault()

    const task = document.querySelector('#task'),
      due = document.querySelector('#due'),
      json = { taskname: task.value, dueDate: due.value },
      body = JSON.stringify(json)

    fetch('/submit', {
      method: 'POST',
      body
    })
      .then(response => response.json())
      .then((json) => {
        Array.from(document.body.getElementsByClassName(`container`)).forEach(e => e.innerHTML = '')
        Array.from(json).forEach(element => {
          let container = document.body.getElementsByClassName(`container ${element.priority}`) 
          container[0].innerHTML += element.html      
        })
      })
      let form = document.querySelector('form')
      form.reset()
    return false
  }

  const open = function (priority) {
    let dropdown = document.getElementsByClassName(`dropdown ${priority}`)
    if (dropdown[0].className.includes("closed")){
      dropdown[0].className = `dropdown ${priority} open`
      let container = document.getElementsByClassName(`container ${priority}`)
      container[0].className = `container ${priority} open`
    } else {
      dropdown[0].className = `dropdown ${priority} closed`
      let container = document.getElementsByClassName(`container ${priority}`)
      container[0].className = `container ${priority} closed`
    }
  }

  window.onload = function () {
    const button = document.querySelector('button')
    const summaries = document.getElementsByTagName('summary')
    button.onclick = submit
    Array.from(summaries).forEach(summary => {
      summary.onclick = () => {
        open(summary.className)
      }
    })
  }

</script>

</html>