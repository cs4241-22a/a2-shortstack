<!doctype html>
<html lang="en">
  <head>
    <title>CS4241 Assignment 2</title>
    <meta charset="utf-8">
    <link href="css/style.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap" rel="stylesheet">
  </head>
  <body>
    <h1>Movie Ranker</h1>
    <header id="addmovieheader">Add Movie</header>
    <form id="addmovie" action="">
      <section class="moviefield">
        <label for="movietitle">Title:</label>
        <input type='text' id='movietitle' placeholder="Enter Movie Title">
      </section>
      <section class="moviefield">
        <label for="movieyear">Year:</label>
        <input type='text' id='movieyear' placeholder="Enter Movie Year">
      </section>
      <section class="moviefield">
        <label for="movierank">Rank(1-5):</label>
        <input type='text' id='movierank' placeholder="Enter Movie Rank">
      </section>
      <button id="submitbutton">submit</button>
    </form>
    <!--<button id="resultsbutton">reload results</button>-->
    <p>Rank Key</p>
    <section id="rankkey">
      <p class="colorbox red">&nbsp&nbsp&nbsp1</p> 
      <p class="colorbox orange">&nbsp&nbsp&nbsp2</p>      
      <p class="colorbox yellow">&nbsp&nbsp&nbsp3</p>      
      <p class="colorbox blue">&nbsp&nbsp&nbsp4</p>      
      <p class="colorbox green">&nbsp&nbsp&nbsp5</p>      
    </section>
    <section id="results"></section>
  </body>
  <script>

  const submit = function( e ) {
    // prevent default form action from being carried out
    e.preventDefault()

    const inputTitle = document.getElementById('movietitle'),
          inputYear = document.getElementById('movieyear'),
          inputRank = document.getElementById('movierank'),
          json = { title: inputTitle.value, year: inputYear.value, rank: inputRank.value },
          body = JSON.stringify( json )

    fetch( '/submit', {
      method:'POST',
      body 
    })

    results();

    return false
  }

  /**
   * Fetch current list of movies
   */
  function results() {
    fetch( '/appdata', 
    {
      method:'GET'
    })
    .then(function(response) 
    {
      return response.json()
    })
    .then( function(response) 
    {
      showMovies(response);
    })

    return false
  }
  /**
   * Enter movie information into grid cells
   */
  function showMovies(jsonmovies) 
  {
    jsonmovies.sort((movie1, movie2) => compareAlphabetical(movie1.title, movie2.title));
    const resultsSection = document.getElementById('results');
    resultsSection.innerHTML = "";
    for(let movie of jsonmovies)
    {
      let rankColor;
      if(movie.rank === 1)
      {
        rankColor = "red"
      }
      else if(movie.rank === 2)
      {
        rankColor = "orange"
      }
      else if(movie.rank === 3)
      {
        rankColor = "#ffe100"
      }
      else if(movie.rank === 4)
      {
        rankColor = "blue"
      }
      else if(movie.rank === 5)
      {
        rankColor = "green"
      }
      resultsSection.innerHTML += `<div class="resultscell" style="border-color: ${rankColor};"><p id="movietitledisplay">${movie.title}</p><p>${movie.year}</p><br><p>Rank: ${movie.rank}</p><p>Date Watched: ${movie.date_watched}</p><p>Release vs Watch date: ${movie.years_between} years</p></div>`;
    }
  }
  /**
   * Compare method to sort strings alphabetically 
   */
  function compareAlphabetical(str1, str2)
  {
    return str1.toLowerCase() > str2.toLowerCase() ? 1 : -1;
  }

  window.onload = function() {
    const submitbutton = document.getElementById('submitbutton')
    submitbutton.onclick = submit
    //preload movie data from server
    results();
  }

  </script>
</html>
